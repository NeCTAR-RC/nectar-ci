- project:
    name: puppet-aodh
    jobs:
      - '{name}-puppet-unit':
          organisation: 'NeCTAR-RC'
- project:
    name: puppet-apache
    jobs:
      - '{name}-puppet-unit':
          organisation: 'internal'
- project:
    name: puppet-ardc
    jobs:
      - '{name}-puppet-unit':
          organisation: 'internal'
      - '{name}-pre-commit-all':
          organisation: 'internal'
- project:
    name: puppet-barbican
    jobs:
      - '{name}-puppet-unit':
          organisation: 'NeCTAR-RC'
- project:
    name: puppet-bind
    jobs:
      - '{name}-puppet-unit':
          organisation: 'NeCTAR-RC'
- project:
    name: puppet-blazar
    jobs:
      - '{name}-puppet-unit':
          organisation: 'NeCTAR-RC'
- project:
    name: puppet-ceilometer
    jobs:
      - '{name}-puppet-unit':
          organisation: 'NeCTAR-RC'
- project:
    name: puppet-ceph
    jobs:
      - '{name}-puppet-unit':
          organisation: 'NeCTAR-RC'
- project:
    name: puppet-cinder
    jobs:
      - '{name}-puppet-unit':
          organisation: 'NeCTAR-RC'
- project:
    name: puppet-cloudkitty
    jobs:
      - '{name}-puppet-unit':
          organisation: 'NeCTAR-RC'
- project:
    name: puppet-dashboard
    jobs:
      - '{name}-puppet-unit':
          organisation: 'internal'
- project:
    name: puppet-denyhosts
    jobs:
      - '{name}-puppet-unit':
          organisation: 'internal'
- project:
    name: puppet-designate
    jobs:
      - '{name}-puppet-unit':
          organisation: 'NeCTAR-RC'
- project:
    name: puppet-ec2api
    jobs:
      - '{name}-puppet-unit':
          organisation: 'NeCTAR-RC'
- project:
    name: puppet-elasticsearch
    jobs:
      - '{name}-puppet-unit':
          organisation: 'NeCTAR-RC'
- project:
    name: puppet-elk
    jobs:
      - '{name}-puppet-unit':
          organisation: 'NeCTAR-RC'
- project:
    name: puppet-etckeeper
    jobs:
      - '{name}-puppet-unit':
          organisation: 'NeCTAR-RC'
- project:
    name: puppet-gnocchi
    jobs:
      - '{name}-puppet-unit':
          organisation: 'NeCTAR-RC'
- project:
    name: puppet-influxdb
    jobs:
      - '{name}-puppet-unit':
          organisation: 'NeCTAR-RC'
- project:
    name: puppet-ironic
    jobs:
      - '{name}-puppet-unit':
          organisation: 'NeCTAR-RC'
- project:
    name: puppet-kmod
    jobs:
      - '{name}-dummy':
          organisation: 'NeCTAR-RC'
- project:
    name: puppet-manuka
    jobs:
      - '{name}-puppet-unit':
          organisation: 'NeCTAR-RC'
- project:
    name: puppet-memcached
    jobs:
      - '{name}-puppet-unit':
          organisation: 'NeCTAR-RC'
- project:
    name: puppet-mlocate
    jobs:
      - '{name}-puppet-unit':
          organisation: 'NeCTAR-RC'
- project:
    name: puppet-mongo
    jobs:
      - '{name}-puppet-unit':
          organisation: 'NeCTAR-RC'
- project:
    name: puppet-murano
    jobs:
      - '{name}-puppet-unit':
          organisation: 'NeCTAR-RC'
- project:
    name: puppet-facts
    jobs:
      - '{name}-puppet-unit':
          organisation: 'internal'
- project:
    name: puppet-fail2ban
    jobs:
      - '{name}-puppet-unit':
          organisation: 'NeCTAR-RC'
- project:
    name: puppet-ganglia
    jobs:
      - '{name}-puppet-unit':
          organisation: 'internal'
- project:
    name: puppet-gitea
    jobs:
      - '{name}-puppet-unit':
          organisation: 'NeCTAR-RC'
- project:
    name: puppet-glance
    jobs:
      - '{name}-puppet-unit':
          organisation: 'NeCTAR-RC'
- project:
    name: puppet-graphite
    jobs:
      - '{name}-puppet-unit':
          organisation: 'NeCTAR-RC'
- project:
    name: puppet-haproxy
    jobs:
      - '{name}-puppet-unit':
          organisation: 'NeCTAR-RC'
- project:
    name: puppet-heat
    jobs:
      - '{name}-puppet-unit':
          organisation: 'NeCTAR-RC'
- project:
    name: puppet-intersect
    jobs:
      - '{name}-puppet-unit':
          organisation: 'internal'
- project:
    name: puppet-iptables_templates
    jobs:
      - '{name}-puppet-unit':
          organisation: 'internal'
- project:
    name: puppet-jenkins
    jobs:
      - '{name}-puppet-unit':
          organisation: 'NeCTAR-RC'
- project:
    name: puppet-karaage
    jobs:
      - '{name}-puppet-unit':
          organisation: 'NeCTAR-RC'
- project:
    name: puppet-kexec
    jobs:
      - '{name}-puppet-unit':
          organisation: 'NeCTAR-RC'
- project:
    name: puppet-keystone
    jobs:
      - '{name}-puppet-unit':
          organisation: 'NeCTAR-RC'
- project:
    name: puppet-logrotate
    jobs:
      - '{name}-puppet-unit':
          organisation: 'internal'
- project:
    name: puppet-logstash
    jobs:
      - '{name}-puppet-unit':
          organisation: 'internal'
- project:
    name: puppet-magnum
    jobs:
      - '{name}-puppet-unit':
          organisation: 'NeCTAR-RC'
- project:
    name: puppet-manila
    jobs:
      - '{name}-puppet-unit':
          organisation: 'NeCTAR-RC'
- project:
    name: puppet-mariadb
    jobs:
      - '{name}-puppet-unit':
          organisation: 'NeCTAR-RC'
- project:
    name: puppet-melbourne
    jobs:
      - '{name}-puppet-unit':
          organisation: 'resplat-cloud'
- project:
    name: puppet-mongodb
    jobs:
      - '{name}-puppet-unit':
          organisation: 'internal'
- project:
    name: puppet-mysql
    jobs:
      - '{name}-puppet-unit':
          organisation: 'NeCTAR-RC'
- project:
    name: puppet-nag
    jobs:
      - '{name}-puppet-unit':
          organisation: 'internal'
- project:
    name: puppet-nagios
    jobs:
      - '{name}-puppet-unit':
          organisation: 'NeCTAR-RC'
- project:
    name: puppet-nectar
    jobs:
      - '{name}-puppet-unit':
          organisation: 'internal'
      - '{name}-puppet-prod-review':
          organisation: 'internal'
- project:
    name: puppet-neutron
    jobs:
      - '{name}-puppet-unit':
          organisation: 'NeCTAR-RC'
      - '{name}-puppet-openstack-spec':
          organisation: 'NeCTAR-RC'
          skip-vote: true
- project:
    name: puppet-nginx
    jobs:
      - '{name}-puppet-unit':
          organisation: 'NeCTAR-RC'
- project:
    name: puppet-nova
    jobs:
      - '{name}-puppet-unit':
          organisation: 'NeCTAR-RC'
- project:
    name: puppet-ntp
    jobs:
      - '{name}-puppet-unit':
          organisation: 'internal'
- project:
    name: puppet-octavia
    jobs:
      - '{name}-puppet-unit':
          organisation: 'NeCTAR-RC'
- project:
    name: puppet-openstack
    jobs:
      - '{name}-puppet-unit':
          organisation: 'NeCTAR-RC'
- project:
    name: puppet-openstacklib
    jobs:
      - '{name}-puppet-unit':
          organisation: 'NeCTAR-RC'
- project:
    name: puppet-openvpn
    jobs:
      - '{name}-puppet-unit':
          organisation: 'NeCTAR-RC'
- project:
    name: puppet-oslo
    jobs:
      - '{name}-puppet-unit':
          organisation: 'NeCTAR-RC'
- project:
    name: puppet-ovn
    jobs:
      - '{name}-puppet-unit':
          organisation: 'NeCTAR-RC'
- project:
    name: puppet-patchman
    jobs:
      - '{name}-puppet-unit':
          organisation: 'NeCTAR-RC'
- project:
    name: puppet-pawsey
    jobs:
      - '{name}-puppet-unit':
          organisation: 'internal'
      - '{name}-pre-commit-all':
          organisation: 'internal'
- project:
    name: puppet-physical
    jobs:
      - '{name}-puppet-unit':
          organisation: 'NeCTAR-RC'
- project:
    name: camptocamp-podman
    jobs:
      - '{name}-puppet-unit':
          organisation: 'NeCTAR-RC'
- project:
    name: puppet-postfix
    jobs:
      - '{name}-puppet-unit':
          organisation: 'NeCTAR-RC'
- project:
    name: puppet-prometheus
    jobs:
      - '{name}-puppet-unit':
          organisation: 'NeCTAR-RC'
- project:
    name: puppet-puppet
    jobs:
      - '{name}-puppet-unit':
          organisation: 'internal'
- project:
    name: puppet-puppetboard
    jobs:
      - '{name}-puppet-unit':
          organisation: 'NeCTAR-RC'
- project:
    name: puppet-profile
    jobs:
      - '{name}-puppet-unit':
          organisation: 'internal'
      - '{name}-puppet-prod-review':
          organisation: 'internal'
- project:
    name: puppet-python
    jobs:
      - '{name}-puppet-unit':
          organisation: 'NeCTAR-RC'
- project:
    name: puppet-qld
    jobs:
      - '{name}-puppet-unit':
          organisation: 'internal'
- project:
    name: puppet-rabbitmq
    jobs:
      - '{name}-puppet-unit':
          organisation: 'NeCTAR-RC'
- project:
    name: puppet-rcshibboleth
    jobs:
      - '{name}-puppet-unit':
          organisation: 'internal'
- project:
    name: puppet-role
    jobs:
      - '{name}-puppet-unit':
          organisation: 'internal'
      - '{name}-puppet-prod-review':
          organisation: 'internal'
- project:
    name: puppet-rsyslog
    jobs:
      - '{name}-puppet-unit':
          organisation: 'NeCTAR-RC'
- project:
    name: puppet-screen
    jobs:
      - '{name}-puppet-unit':
          organisation: 'internal'
- project:
    name: puppet-shibboleth
    jobs:
      - '{name}-puppet-unit':
          organisation: 'internal'
- project:
    name: puppet-spartan
    jobs:
      - '{name}-puppet-unit':
          organisation: 'resplat-hpc'
- project:
    name: puppet-sut
    jobs:
      - '{name}-puppet-unit':
          organisation: 'internal'
- project:
    name: puppet-sysctl
    jobs:
      - '{name}-puppet-unit':
          organisation: 'NeCTAR-RC'
- project:
    name: puppet-systemrootwrap
    jobs:
      - '{name}-puppet-unit':
          organisation: 'internal'
- project:
    name: puppet-tempest
    jobs:
      - '{name}-puppet-unit':
          organisation: 'NeCTAR-RC'
- project:
    name: puppetlabs-docker
    jobs:
      - '{name}-puppet-unit':
          organisation: 'NeCTAR-RC'
- project:
    name: puppetlabs-rsync
    jobs:
      - '{name}-puppet-unit':
          organisation: 'NeCTAR-RC'
- project:
    name: puppetlabs-puppetdb
    jobs:
      - '{name}-dummy':
          organisation: 'NeCTAR-RC'
- project:
    name: puppetlabs-kubernetes
    jobs:
      - '{name}-puppet-unit':
          organisation: 'NeCTAR-RC'
- job-group:
    name: '{name}-puppet-site-test-jobs'
    jobs:
      - '{name}-yaml'
      - '{name}-puppet-unit-job':
          node: jammy
          skip-vote: false
      - '{name}-r10k-deploy':
          r10k_host: 'r10k.svc.artm.rctest.nectar.org.au'
          r10k_host_public: 'r10k.rctest.nectar.org.au'
      - '{name}-r10k-deploy-control-repo':
          puppet_host: 'puppet.svc.artm.rctest.nectar.org.au'
      - '{name}-r10k-cleanup':
          r10k_host: 'r10k.svc.artm.rctest.nectar.org.au'
      - '{name}-r10k-diff-catalog':
          r10k_host: 'r10k.svc.artm.rctest.nectar.org.au'
- job-group:
    name: '{name}-puppet-site-prod-jobs'
    jobs:
      - '{name}-yaml'
      - '{name}-puppet-unit-job':
          node: jammy
          skip-vote: false
      - '{name}-r10k-deploy':
          r10k_host: 'r10k.svc.artm.rc.nectar.org.au'
          r10k_host_public: 'r10k.rc.nectar.org.au'
      - '{name}-r10k-deploy-control-repo':
          puppet_host: 'puppet.svc.artm.rc.nectar.org.au'
      - '{name}-r10k-cleanup':
          r10k_host: 'r10k.svc.artm.rc.nectar.org.au'
      - '{name}-r10k-diff-catalog':
          r10k_host: 'r10k.svc.artm.rc.nectar.org.au'
- project:
    name: puppet-site-adelaide
    jobs:
      - '{name}-puppet-site-prod-jobs':
          organisation: 'Intersect'
- project:
    name: puppet-site-ardc
    jobs:
      - '{name}-puppet-site-prod-jobs':
          organisation: 'internal'
      - '{name}-pre-commit-all':
          organisation: 'internal'
- project:
    name: puppet-site-ardctest
    jobs:
      - '{name}-puppet-site-test-jobs':
          organisation: 'internal'
      - '{name}-pre-commit-all':
          organisation: 'internal'
- project:
    name: puppet-site-melbourne
    jobs:
      - '{name}-puppet-site-prod-jobs':
          organisation: 'resplat-cloud'
- project:
    name: puppet-site-melbournetest
    jobs:
      - '{name}-puppet-site-test-jobs':
          organisation: 'resplat-cloud'
- project:
    name: puppet-site-monashtest
    jobs:
      - '{name}-puppet-site-test-jobs':
          organisation: 'nectar-monash'
- project:
    name: puppet-site-monashunder
    jobs:
      - '{name}-puppet-site-prod-jobs':
          organisation: 'nectar-monash'
- project:
    name: puppet-site-monash
    jobs:
      - '{name}-puppet-site-prod-jobs':
          organisation: 'nectar-monash'
- project:
    name: puppet-site-monashprivate
    jobs:
      - '{name}-puppet-site-prod-jobs':
          organisation: 'nectar-monash'
- project:
    name: puppet-site-nectar
    jobs:
      - '{name}-puppet-site-prod-jobs':
          organisation: 'internal'
      - '{name}-pre-commit-all':
          organisation: 'internal'
- project:
    name: puppet-site-nectarunder
    jobs:
      - '{name}-puppet-site-prod-jobs':
          organisation: 'internal'
      - '{name}-pre-commit-all':
          organisation: 'internal'
- project:
    name: puppet-site-pawsey
    jobs:
      - '{name}-puppet-site-prod-jobs':
          organisation: 'internal'
      - '{name}-pre-commit-all':
          organisation: 'internal'
- project:
    name: puppet-site-pawseytest
    jobs:
      - '{name}-puppet-site-test-jobs':
          organisation: 'internal'
      - '{name}-pre-commit-all':
          organisation: 'internal'
- project:
    name: puppet-site-spartan
    jobs:
      - '{name}-puppet-site-prod-jobs':
          organisation: 'resplat-hpc'
- project:
    name: puppet-site-tas
    jobs:
      - '{name}-puppet-site-prod-jobs':
          organisation: 'tas-gerrit'
- project:
    name: puppet-site-tasunder
    jobs:
      - '{name}-puppet-site-prod-jobs':
          organisation: 'tas-gerrit'
- project:
    name: puppet-site-thespian
    jobs:
      - '{name}-puppet-site-test-jobs':
          organisation: 'resplat-hpc'
- project:
    name: puppet-site-swinburne
    jobs:
      - '{name}-puppet-site-prod-jobs':
          organisation: 'internal'
- project:
    name: puppet-site-uommediafluxtest
    jobs:
      - '{name}-puppet-site-test-jobs':
          organisation: 'resplat-cloud'
- project:
    name: puppet-site-rctest
    jobs:
      - '{name}-puppet-site-test-jobs':
          organisation: 'internal'
      - '{name}-diff-{backend}':
          backend: 'catalog-diff'
          organisation: 'internal'
          r10k_host: 'r10k.svc.artm.rctest.nectar.org.au'
      - '{name}-pre-commit-all':
          organisation: 'internal'
- project:
    name: puppet-site-undertest
    jobs:
      - '{name}-puppet-site-test-jobs':
          organisation: 'internal'
- project:
    name: puppet-site-auckland
    jobs:
      - '{name}-puppet-site-prod-jobs':
          organisation: 'internal'
- project:
    name: puppet-site-aucklandunder
    jobs:
      - '{name}-puppet-site-prod-jobs':
          organisation: 'internal'
- project:
    name: puppet-site-aucklandtest
    jobs:
      - '{name}-puppet-site-test-jobs':
          organisation: 'internal'
- project:
    name: puppet-site-auckland_sre
    jobs:
      - '{name}-puppet-site-prod-jobs':
          organisation: 'Auckland'
- project:
    name: puppet-site-auckland_sreunder
    jobs:
      - '{name}-puppet-site-prod-jobs':
          organisation: 'Auckland'
- project:
    name: puppet-site-intersect
    jobs:
      - '{name}-puppet-site-prod-jobs':
          organisation: 'internal'
- project:
    name: puppet-site-qld_ctrl
    jobs:
      - '{name}-puppet-site-prod-jobs':
          organisation: 'QRIScloud'
- project:
    name: puppet-site-qld_rest
    jobs:
      - '{name}-puppet-site-prod-jobs':
          organisation: 'QRIScloud'
- project:
    name: puppet-snmp
    jobs:
      - '{name}-puppet-unit':
          organisation: 'internal'
- project:
    name: puppet-ssh
    jobs:
      - '{name}-puppet-unit':
          organisation: 'internal'
- project:
    name: puppet-swift
    jobs:
      - '{name}-puppet-unit':
          organisation: 'NeCTAR-RC'
- project:
    name: puppet-tas
    jobs:
      - '{name}-puppet-unit':
          organisation: 'internal'
- project:
    name: puppet-trove
    jobs:
      - '{name}-puppet-unit':
          organisation: 'NeCTAR-RC'
- project:
    name: puppet-ubuntu
    jobs:
      - '{name}-puppet-unit':
          organisation: 'internal'
- project:
    name: puppet-vim
    jobs:
      - '{name}-puppet-unit':
          organisation: 'internal'
- project:
    name: puppet-virtual
    jobs:
      - '{name}-puppet-unit':
          organisation: 'internal'
- project:
    name: puppet-freshdesk
    jobs:
      - '{name}-puppet-unit':
          organisation: 'NeCTAR-RC'
- project:
    name: hieradata
    jobs:
      - '{name}-yaml':
          organisation: 'internal'
      - 'hieradata-duplicate-check':
          organisation: 'internal'
- project:
    name: puppet-monash
    jobs:
      - '{name}-puppet-unit':
          organisation: 'internal'
- job:
    name: 'puppet-module-deploy-testing'
    defaults: global
    node: internal
    quiet-period: 20
    parameters:
      - string:
          name: GERRIT_REFSPEC
          default: refs/heads/master
          description: "The default ref to test."
      - string:
          name: GERRIT_BRANCH
          default: master
          description: "The default branch to test."
    properties:
      - build-discarder:
          num-to-keep: 50
      - lockable-resources:
          resources: "puppet-library"
    triggers:
      - gerrit:
          trigger-on:
            - change-merged-event
          projects:
            - project-compare-type: 'REG_EXP'
              project-pattern: '.*/puppet-(?!site-|library|melbourne|pawsey|spartan|tas).*'
              branches:
                - branch-compare-type: 'PLAIN'
                  branch-pattern: 'master'
                - branch-compare-type: 'REG_EXP'
                  branch-pattern: 'nectar/.*'
            - project-compare-type: 'PLAIN'
              project-pattern: 'NeCTAR-RC/camptocamp-podman'
              branches:
                - branch-compare-type: 'PLAIN'
                  branch-pattern: 'master'
          silent: false
          escape-quotes: true
          skip-vote:
            successful: true
            failed: true
            unstable: true
            notbuilt: true
    builders:
      - ssh-builder:
          ssh-user-ip: puppet@puppet.svc.artm.rctest.nectar.org.au:22
          command: /usr/local/sbin/update-test-modules.sh $GERRIT_PROJECT
    publishers: !include: publisher.yaml.inc
    wrappers:
      - ssh-agent-credentials:
          users:
            - 'cd8b8dd3-b897-4ecb-985d-180d5b6f8498'
- job:
    name: 'puppet-module-deploy-production'
    defaults: global
    node: internal
    quiet-period: 20
    parameters:
      - string:
          name: GERRIT_REFSPEC
          default: refs/heads/master
          description: "The default ref to test."
      - string:
          name: GERRIT_BRANCH
          default: master
          description: "The default branch to test."
    properties:
      - lockable-resources:
          resources: "puppet-library"
    triggers:
      - gerrit:
          trigger-on:
            - change-merged-event
          projects:
            - project-compare-type: 'PLAIN'
              project-pattern: 'internal/puppet-role'
              branches:
                - branch-compare-type: 'PLAIN'
                  branch-pattern: 'production'
            - project-compare-type: 'PLAIN'
              project-pattern: 'internal/puppet-profile'
              branches:
                - branch-compare-type: 'PLAIN'
                  branch-pattern: 'production'
            - project-compare-type: 'PLAIN'
              project-pattern: 'internal/puppet-nectar'
              branches:
                - branch-compare-type: 'PLAIN'
                  branch-pattern: 'production'
          silent: false
          escape-quotes: true
          skip-vote:
            successful: true
            failed: true
            unstable: true
            notbuilt: true
    builders:
      - ssh-builder:
          ssh-user-ip: puppet@puppet.svc.artm.rc.nectar.org.au:22
          command: /var/lib/puppet/librarian/bin/update-prod-module-jenkins.sh $GERRIT_PROJECT
    publishers: !include: publisher.yaml.inc
    wrappers:
      - ssh-agent-credentials:
          users:
            - 'cd8b8dd3-b897-4ecb-985d-180d5b6f8498'

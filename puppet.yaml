- project:
    name: puppet-anu
    jobs:
      - '{name}-puppet-unit':
         access: 'nobody'
         organisation: 'internal'

- project:
    name: puppet-aodh
    jobs:
      - '{name}-puppet-unit':
         access: 'anonymous'
         organisation: 'NeCTAR-RC'

- project:
    name: puppet-apache
    jobs:
      - '{name}-puppet-unit':
         access: 'nobody'
         organisation: 'internal'

- project:
    name: puppet-bind
    jobs:
      - '{name}-puppet-unit':
         access: 'anonymous'
         organisation: 'NeCTAR-RC'

- project:
    name: puppet-ceilometer
    jobs:
      - '{name}-puppet-unit':
         access: 'anonymous'
         organisation: 'NeCTAR-RC'

- project:
    name: puppet-ceph
    jobs:
      - '{name}-puppet-unit':
         access: 'anonymous'
         organisation: 'NeCTAR-RC'

- project:
    name: puppet-cinder
    jobs:
      - '{name}-puppet-unit':
         access: 'anonymous'
         organisation: 'NeCTAR-RC'

- project:
    name: puppet-crams
    jobs:
      - '{name}-puppet-unit':
         access: 'anonymous'
         organisation: 'NeCTAR-RC'

- project:
    name: puppet-dashboard
    jobs:
      - '{name}-puppet-unit':
         access: 'nobody'
         organisation: 'internal'

- project:
    name: puppet-denyhosts
    jobs:
      - '{name}-puppet-unit':
         access: 'nobody'
         organisation: 'internal'

- project:
    name: puppet-designate
    jobs:
      - '{name}-puppet-unit':
         access: 'anonymous'
         organisation: 'NeCTAR-RC'

- project:
    name: puppet-ec2api
    jobs:
      - '{name}-puppet-unit':
         access: 'anonymous'
         organisation: 'NeCTAR-RC'

- project:
    name: puppet-elasticsearch
    jobs:
      - '{name}-puppet-unit':
         access: 'anonymous'
         organisation: 'NeCTAR-RC'

- project:
    name: puppet-elk
    jobs:
      - '{name}-puppet-unit':
         access: 'anonymous'
         organisation: 'NeCTAR-RC'

- project:
    name: puppet-ersa
    jobs:
      - '{name}-puppet-unit':
         access: 'nobody'
         organisation: 'internal'

- project:
    name: puppet-etckeeper
    jobs:
      - '{name}-puppet-unit':
         access: 'anonymous'
         organisation: 'NeCTAR-RC'

- project:
    name: puppet-gnocchi
    jobs:
      - '{name}-puppet-unit':
         access: 'anonymous'
         organisation: 'NeCTAR-RC'

- project:
    name: puppet-memcached
    jobs:
      - '{name}-puppet-unit':
         access: 'anonymous'
         organisation: 'NeCTAR-RC'

- project:
    name: puppet-midonet
    jobs:
      - '{name}-puppet-unit':
         access: 'anonymous'
         organisation: 'NeCTAR-RC'

- project:
    name: puppet-mlocate
    jobs:
      - '{name}-puppet-unit':
         access: 'anonymous'
         organisation: 'NeCTAR-RC'

- project:
    name: puppet-mongo
    jobs:
      - '{name}-puppet-unit':
         access: 'anonymous'
         organisation: 'NeCTAR-RC'

- project:
    name: puppet-murano
    jobs:
      - '{name}-puppet-unit':
         access: 'anonymous'
         organisation: 'NeCTAR-RC'

- project:
    name: puppet-facts
    jobs:
      - '{name}-puppet-unit':
         access: 'nobody'
         organisation: 'internal'

- project:
    name: puppet-fail2ban
    jobs:
      - '{name}-puppet-unit':
         access: 'anonymous'
         organisation: 'NeCTAR-RC'

- project:
    name: puppet-ganglia
    jobs:
      - '{name}-puppet-unit':
         access: 'nobody'
         organisation: 'internal'

- project:
    name: puppet-glance
    jobs:
      - '{name}-puppet-unit':
         access: 'anonymous'
         organisation: 'NeCTAR-RC'

- project:
    name: puppet-graphite
    jobs:
      - '{name}-puppet-unit':
         access: 'anonymous'
         organisation: 'NeCTAR-RC'

- project:
    name: puppet-haproxy
    jobs:
      - '{name}-puppet-unit':
         access: 'anonymous'
         organisation: 'NeCTAR-RC'

- project:
    name: puppet-heat
    jobs:
      - '{name}-puppet-unit':
         access: 'anonymous'
         organisation: 'NeCTAR-RC'

- project:
    name: puppet-intersect
    jobs:
      - '{name}-puppet-unit':
         access: 'nobody'
         organisation: 'internal'

- project:
    name: puppet-iptables_templates
    jobs:
      - '{name}-puppet-unit':
         access: 'nobody'
         organisation: 'internal'

- project:
    name: puppet-ivec
    jobs:
      - '{name}-puppet-unit':
         access: 'nobody'
         organisation: 'internal'

- project:
    name: puppet-jenkins
    jobs:
      - '{name}-puppet-unit':
         access: 'anonymous'
         organisation: 'NeCTAR-RC'

- project:
    name: puppet-karaage
    jobs:
      - '{name}-puppet-unit':
         access: 'anonymous'
         organisation: 'NeCTAR-RC'

- project:
    name: puppet-kexec
    jobs:
      - '{name}-puppet-unit':
         access: 'anonymous'
         organisation: 'NeCTAR-RC'

- project:
    name: puppet-keystone
    jobs:
      - '{name}-puppet-unit':
         access: 'anonymous'
         organisation: 'NeCTAR-RC'

- project:
    name: puppet-logrotate
    jobs:
      - '{name}-puppet-unit':
         access: 'nobody'
         organisation: 'internal'

- project:
    name: puppet-logstash
    jobs:
      - '{name}-puppet-unit':
         access: 'nobody'
         organisation: 'internal'

- project:
    name: puppet-magnum
    jobs:
      - '{name}-puppet-unit':
         access: 'anonymous'
         organisation: 'NeCTAR-RC'

- project:
    name: puppet-manila
    jobs:
      - '{name}-puppet-unit':
         access: 'anonymous'
         organisation: 'NeCTAR-RC'

- project:
    name: puppet-mariadb
    jobs:
      - '{name}-puppet-unit':
         access: 'anonymous'
         organisation: 'NeCTAR-RC'

- project:
    name: puppet-melbourne
    jobs:
      - '{name}-puppet-unit':
         access: 'nobody'
         organisation: 'internal'
         organisation: 'internal'

- project:
    name: puppet-mongodb
    jobs:
      - '{name}-puppet-unit':
         access: 'nobody'
         organisation: 'internal'

- project:
    name: puppet-mysql
    jobs:
      - '{name}-puppet-unit':
         access: 'anonymous'
         organisation: 'NeCTAR-RC'

- project:
    name: puppet-nagios
    jobs:
      - '{name}-puppet-unit':
         access: 'anonymous'
         organisation: 'NeCTAR-RC'

- project:
    name: puppet-nectar
    jobs:
      - '{name}-puppet-unit':
         access: 'anonymous'
         organisation: 'NeCTAR-RC'

- project:
    name: puppet-neutron
    jobs:
      - '{name}-puppet-unit':
         access: 'anonymous'
         organisation: 'NeCTAR-RC'

- project:
    name: puppet-nginx
    jobs:
      - '{name}-puppet-unit':
         access: 'anonymous'
         organisation: 'NeCTAR-RC'

- project:
    name: puppet-nova
    jobs:
      - '{name}-puppet-unit':
         access: 'anonymous'
         organisation: 'NeCTAR-RC'

- project:
    name: puppet-openstack
    jobs:
      - '{name}-puppet-unit':
         access: 'anonymous'
         organisation: 'NeCTAR-RC'

- project:
    name: puppet-openstacklib
    jobs:
      - '{name}-puppet-unit':
         access: 'anonymous'
         organisation: 'NeCTAR-RC'

- project:
    name: puppet-openvpn
    jobs:
      - '{name}-puppet-unit':
         access: 'anonymous'
         organisation: 'NeCTAR-RC'

- project:
    name: puppet-oslo
    jobs:
      - '{name}-puppet-unit':
         access: 'anonymous'
         organisation: 'NeCTAR-RC'

- project:
    name: puppet-patchman
    jobs:
      - '{name}-puppet-unit':
         access: 'anonymous'
         organisation: 'NeCTAR-RC'

- project:
    name: puppet-physical
    jobs:
      - '{name}-puppet-unit':
         access: 'anonymous'
         organisation: 'NeCTAR-RC'

- project:
    name: puppet-postfix
    jobs:
      - '{name}-puppet-unit':
         access: 'anonymous'
         organisation: 'NeCTAR-RC'

- project:
    name: puppet-pound
    jobs:
      - '{name}-puppet-unit':
         access: 'anonymous'
         organisation: 'NeCTAR-RC'

- project:
    name: puppet-puppet
    jobs:
      - '{name}-puppet-unit':
         access: 'nobody'
         organisation: 'internal'

- project:
    name: puppet-puppetboard
    jobs:
      - '{name}-puppet-unit':
         access: 'anonymous'
         organisation: 'NeCTAR-RC'

- project:
    name: puppet-profile
    jobs:
      - '{name}-puppet-unit':
         access: 'nobody'
         organisation: 'internal'
      - '{name}-puppet-prod-review':
         access: 'nobody'
         organisation: 'internal'

- project:
    name: puppet-python
    jobs:
      - '{name}-puppet-unit':
         access: 'anonymous'
         organisation: 'NeCTAR-RC'

- project:
    name: puppet-qld
    jobs:
      - '{name}-puppet-unit':
         access: 'nobody'
         organisation: 'internal'

- project:
    name: puppet-rabbitmq
    jobs:
      - '{name}-puppet-unit':
         access: 'anonymous'
         organisation: 'NeCTAR-RC'

- project:
    name: puppet-rcshibboleth
    jobs:
      - '{name}-puppet-unit':
         access: 'nobody'
         organisation: 'internal'

- project:
    name: puppet-reporting
    jobs:
      - '{name}-puppet-unit':
         access: 'anonymous'
         organisation: 'NeCTAR-RC'

- project:
    name: puppet-role
    jobs:
      - '{name}-puppet-unit':
         access: 'nobody'
         organisation: 'internal'
      - '{name}-puppet-prod-review':
         access: 'nobody'
         organisation: 'internal'

- project:
    name: puppet-rsyslog
    jobs:
      - '{name}-puppet-unit':
         access: 'anonymous'
         organisation: 'NeCTAR-RC'

- project:
    name: puppet-screen
    jobs:
      - '{name}-puppet-unit':
         access: 'nobody'
         organisation: 'internal'

- project:
    name: puppet-sahara
    jobs:
      - '{name}-puppet-unit':
         access: 'anonymous'
         organisation: 'NeCTAR-RC'

- project:
    name: puppet-shibboleth
    jobs:
      - '{name}-puppet-unit':
         access: 'nobody'
         organisation: 'internal'

- project:
    name: puppet-spartan
    jobs:
      - '{name}-puppet-unit':
         access: 'nobody'
         organisation: 'internal'

- project:
    name: puppet-sut
    jobs:
      - '{name}-puppet-unit':
         access: 'nobody'
         organisation: 'internal'

- project:
    name: puppet-sysctl
    jobs:
      - '{name}-puppet-unit':
         access: 'anonymous'
         organisation: 'NeCTAR-RC'

- project:
    name: puppet-tempest
    jobs:
      - '{name}-puppet-unit':
         access: 'anonymous'
         organisation: 'NeCTAR-RC'

- project:
    name: puppet-site-melbourne
    jobs:
      - '{name}-puppet-unit':
         access: 'nobody'
         organisation: 'internal'

- project:
    name: puppet-site-melbournetest
    jobs:
      - '{name}-puppet-unit':
         access: 'nobody'
         organisation: 'internal'

- project:
    name: puppet-site-monashtest
    jobs:
      - '{name}-yaml':
         access: 'nobody'
         organisation: 'nectar-monash'
      - '{name}-puppet-unit':
         access: 'nobody'
         organisation: 'nectar-monash'
      - '{name}-site-deploy':
         access: 'nobody'
         organisation: 'nectar-monash'

- project:
    name: puppet-site-monash
    jobs:
      - '{name}-yaml':
         access: 'nobody'
         organisation: 'nectar-monash'
      - '{name}-puppet-unit':
         access: 'nobody'
         organisation: 'nectar-monash'
      - '{name}-site-deploy':
         access: 'nobody'
         organisation: 'nectar-monash'

- project:
    name: puppet-site-nectar
    jobs:
      - '{name}-yaml':
         access: 'nobody'
         organisation: 'internal'
      - '{name}-puppet-unit':
         access: 'nobody'
         organisation: 'internal'
      - '{name}-r10k-deploy':
         access: 'nobody'
         organisation: 'internal'
      - '{name}-r10k-cleanup':
         access: 'nobody'
         organisation: 'internal'
      - '{name}-site-deploy':
         access: 'nobody'
         organisation: 'internal'

- project:
    name: puppet-site-spartan
    jobs:
      - '{name}-puppet-unit':
         access: 'nobody'
         organisation: 'internal'
      - '{name}-yaml':
         access: 'nobody'
         organisation: 'internal'

- project:
    name: puppet-site-sut
    jobs:
      - '{name}-puppet-unit':
         access: 'nobody'
         organisation: 'internal'
      - '{name}-site-deploy':
         access: 'nobody'
         organisation: 'internal'

- project:
    name: puppet-ntp
    jobs:
      - '{name}-puppet-unit':
         access: 'nobody'
         organisation: 'internal'

- project:
    name: puppet-site-rctest
    jobs:
      - '{name}-yaml':
         access: 'nobody'
         organisation: 'internal'
      - '{name}-puppet-unit':
         access: 'nobody'
         organisation: 'internal'
      - '{name}-r10k-deploy':
         access: 'nobody'
         organisation: 'internal'
      - '{name}-r10k-cleanup':
         access: 'nobody'
         organisation: 'internal'
      - '{name}-site-deploy':
         access: 'nobody'
         organisation: 'internal'

- project:
    name: puppet-site-undertest
    jobs:
      - '{name}-yaml':
         access: 'nobody'
         organisation: 'internal'
      - '{name}-puppet-unit':
         access: 'nobody'
         organisation: 'internal'
      - '{name}-site-deploy':
         access: 'nobody'
         organisation: 'internal'

- project:
    name: puppet-snmp
    jobs:
      - '{name}-puppet-unit':
         access: 'nobody'
         organisation: 'internal'

- project:
    name: puppet-ssh
    jobs:
      - '{name}-puppet-unit':
         access: 'nobody'
         organisation: 'internal'

- project:
    name: puppet-swift
    jobs:
      - '{name}-puppet-unit':
         access: 'anonymous'
         organisation: 'NeCTAR-RC'

- project:
    name: puppet-tas
    jobs:
      - '{name}-puppet-unit':
         access: 'nobody'
         organisation: 'internal'

- project:
    name: puppet-trove
    jobs:
      - '{name}-puppet-unit':
         access: 'anonymous'
         organisation: 'NeCTAR-RC'

- project:
    name: puppet-ubuntu
    jobs:
      - '{name}-puppet-unit':
         access: 'nobody'
         organisation: 'internal'

- project:
    name: puppet-vim
    jobs:
      - '{name}-puppet-unit':
         access: 'nobody'
         organisation: 'internal'

- project:
    name: puppet-virtual
    jobs:
      - '{name}-puppet-unit':
         access: 'nobody'
         organisation: 'internal'

- project:
    name: puppet-netapp
    jobs:
      - '{name}-puppet-unit':
         access: 'anonymous'
         organisation: 'NeCTAR-RC'

- project:
    name: puppet-freshdesk
    jobs:
      - '{name}-puppet-unit':
         access: 'anonymous'
         organisation: 'NeCTAR-RC'

- project:
    name: puppet-grafana
    jobs:
      - '{name}-puppet-unit':
         access: 'anonymous'
         organisation: 'NeCTAR-RC'

- project:
    name: hiera-melbourne
    jobs:
      - '{name}-yaml':
         access: 'nobody'
         organisation: 'internal'

- project:
    name: hiera-sut
    jobs:
      - '{name}-yaml':
         access: 'nobody'
         organisation: 'internal'

- project:
    name: hieradata
    jobs:
      - '{name}-yaml':
         access: 'nobody'
         organisation: 'internal'

- project:
    name: puppet-monash
    jobs:
      - '{name}-puppet-unit':
         access: 'nobody'
         organisation: 'internal'

- project:
    name: hiera-test
    jobs:
      - '{name}-yaml':
         access: 'nobody'
         organisation: 'nectar-monash'


- job:
    name: 'puppet-module-deploy-testing'
    defaults: global
    node: upgrader
    quiet-period: 20

    parameters:
      - string:
          name: GERRIT_REFSPEC
          default: refs/heads/master
          description: "The default ref to test."
      - string:
          name: GERRIT_BRANCH
          default: master
          description: "The default branch to test."

    triggers:
      - gerrit:
          trigger-on:
              - change-merged-event
          projects:
            - project-compare-type: 'REG_EXP'
              project-pattern: 'internal/puppet-.*'
              branches:
                - branch-compare-type: 'PLAIN'
                  branch-pattern: 'master'
                - branch-compare-type: 'REG_EXP'
                  branch-pattern: 'nectar/.*'
            - project-compare-type: 'REG_EXP'
              project-pattern: 'NeCTAR-RC/puppet-.*'
              branches:
                - branch-compare-type: 'PLAIN'
                  branch-pattern: 'master'
                - branch-compare-type: 'REG_EXP'
                  branch-pattern: 'nectar/.*'
          silent: false
          escape-quotes: true

          skip-vote:
            successful: true
            failed: true
            unstable: true
            notbuilt: true

    builders:
      - ssh-builder:
          ssh-user-ip: puppet@puppet.mgmt.rc.nectar.org.au:22
          command: /var/lib/puppet/update-test-modules.sh $GERRIT_PROJECT

    wrappers:
      - ssh-agent-credentials:
          users:
              - '4946c3a5-9f5e-4eac-9ec4-90e1e348db14'

- job:
    name: 'puppet-module-deploy-production'
    defaults: global
    node: upgrader
    quiet-period: 20

    parameters:
      - string:
          name: GERRIT_REFSPEC
          default: refs/heads/master
          description: "The default ref to test."
      - string:
          name: GERRIT_BRANCH
          default: master
          description: "The default branch to test."

    triggers:
      - gerrit:
          trigger-on:
              - change-merged-event
          projects:
            - project-compare-type: 'PLAIN'
              project-pattern: 'internal/puppet-role'
              branches:
                - branch-compare-type: 'PLAIN'
                  branch-pattern: 'production'
            - project-compare-type: 'PLAIN'
              project-pattern: 'internal/puppet-profile'
              branches:
                - branch-compare-type: 'PLAIN'
                  branch-pattern: 'production'
            - project-compare-type: 'PLAIN'
              project-pattern: 'internal/puppet-anu'
              branches:
                - branch-compare-type: 'PLAIN'
                  branch-pattern: 'master'
            - project-compare-type: 'PLAIN'
              project-pattern: 'internal/puppet-intersect'
              branches:
                - branch-compare-type: 'PLAIN'
                  branch-pattern: 'master'
            - project-compare-type: 'PLAIN'
              project-pattern: 'internal/puppet-qld'
              branches:
                - branch-compare-type: 'PLAIN'
                  branch-pattern: 'master'
            - project-compare-type: 'PLAIN'
              project-pattern: 'internal/puppet-tas'
              branches:
                - branch-compare-type: 'PLAIN'
                  branch-pattern: 'master'
          silent: false
          escape-quotes: true

          skip-vote:
            successful: true
            failed: true
            unstable: true
            notbuilt: true

    builders:
      - ssh-builder:
          ssh-user-ip: puppet@puppet.mgmt.rc.nectar.org.au:22
          command: /var/lib/puppet/librarian/bin/update-prod-module-jenkins.sh $GERRIT_PROJECT

    wrappers:
      - ssh-agent-credentials:
          users:
              - '4946c3a5-9f5e-4eac-9ec4-90e1e348db14'

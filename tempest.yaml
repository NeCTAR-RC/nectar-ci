- job:
    name: tempest-compute-host-check
    defaults: global
    node: tempest
    concurrent: true
    scm:
      - git:
         url: ssh://review.rc.nectar.org.au:29418/internal/nectar-testing.git
         credentials-id: 4946c3a5-9f5e-4eac-9ec4-90e1e348db14
    builders:
      - shell: |
          #!/bin/bash
          echo
          echo "================================================================="
          echo
          echo "                   CLOUD: $CLOUD"
          echo "                   AZ:    $AVAILABILITY_ZONE"
          echo "                   HOST:  $HOST"
          echo
          echo "================================================================="
          echo
          . /opt/tempest/bin/activate
          tmpdir=`mktemp -d --suffix=_tempest`
          cd $WORKSPACE/tempest
          ./setup_tempest.py --host $HOST -s $AVAILABILITY_ZONE -e $CLOUD -j check-compute-host $tmpdir
          cd $tmpdir
          stestr run --serial --whitelist-file $WORKSPACE/tempest/whitelists/check-compute-host.yaml 2>&1 | grep --line-buffered -vE ' \w+Warning: |self._sock = None'
          RET=${PIPESTATUS[0]}
          rm -rf $tmpdir
          exit $RET
    parameters:
      - choice:
          name: 'CLOUD'
          choices:
            - production
            - testing
            - development
          description: "Cloud to run tempest on (Production, Test, Dev). Leave as Production if unsure."
      - choice:
          name: 'AVAILABILITY_ZONE'
          choices:
            - auckland
            - intersect-01
            - melbourne-np
            - melbourne-qh2
            - melbourne-qh2-uom
            - monash-01
            - monash-02
            - monash-03
            - nci
            - qld
            - sa
            - swinburne-01
            - tasmania
            - tasmania-s
            - coreservices
            - qh2-test
            - cn
            - elk
          description: 'Availability zone.'
      - string:
          name: 'HOST'
          description: |
                Nova host to test. <br>
                - Host must be in AVAILABILITY_ZONE; if not nova will return a 'No Valid Host' error.<br>
                - Leave blank to let scheduler choose a host.
    properties:
      - authorization:
          'nobody':
            - job-read
            - job-discover

- job:
    name: tempest-cinder-check
    defaults: global
    node: tempest
    concurrent: true
    scm:
      - git:
         url: ssh://review.rc.nectar.org.au:29418/internal/nectar-testing.git
         credentials-id: 4946c3a5-9f5e-4eac-9ec4-90e1e348db14
    builders:
      - shell: |
          #!/bin/bash
          . /opt/tempest/bin/activate
          tmpdir=`mktemp -d --suffix=_tempest`
          cd $WORKSPACE/tempest/
          ./setup_tempest.py -s $AVAILABILITY_ZONE -e $CLOUD -j check-cinder $tmpdir
          cd $tmpdir
          stestr run --serial --whitelist-file $WORKSPACE/tempest/whitelists/check-cinder.yaml 2>&1 | grep --line-buffered -vE ' \w+Warning: |self._sock = None'
          RET=${PIPESTATUS[0]}
          rm -rf $tmpdir
          exit $RET
    parameters:
      - choice:
          name: 'CLOUD'
          choices:
            - production
            - testing
            - development
          description: "Cloud to run tempest on (Production, Test, Dev). Leave as Production if unsure."
      - choice:
          name: 'AVAILABILITY_ZONE'
          choices:
            - auckland
            - intersect-01
            - melbourne-np
            - melbourne-qh2
            - melbourne-qh2-uom
            - monash-01
            - monash-02
            - monash-03
            - nci
            - qld
            - sa
            - swinburne-01
            - tasmania
            - tasmania-s
            - coreservices
            - qh2-test
            - cn
            - elk
          description: 'Availability zone.'
    properties:
      - authorization:
          'nobody':
            - job-read
            - job-discover

- job:
    name: tempest-magnum-check
    defaults: global
    node: tempest
    concurrent: true
    scm:
      - git:
         url: ssh://review.rc.nectar.org.au:29418/internal/nectar-testing.git
         credentials-id: 4946c3a5-9f5e-4eac-9ec4-90e1e348db14
    builders:
      - shell: |
          #!/bin/bash
          . /opt/tempest/bin/activate
          tmpdir=`mktemp -d --suffix=_tempest`
          cd $WORKSPACE/tempest/
          ./setup_tempest.py -s $AVAILABILITY_ZONE -e $CLOUD -j check-magnum $tmpdir
          cd $tmpdir
          stestr run --serial --whitelist-file $WORKSPACE/tempest/whitelists/check-magnum.yaml 2>&1 | grep --line-buffered -vE ' \w+Warning: |self._sock = None'
          RET=${PIPESTATUS[0]}
          rm -rf $tmpdir
          exit $RET
    parameters:
      - choice:
          name: 'CLOUD'
          choices:
            - production
            - testing
            - development
          description: "Cloud to run tempest on (production, testing or development). Leave as Production if unsure."
      - choice:
          name: 'AVAILABILITY_ZONE'
          choices:
            - auckland
            - intersect-01
            - melbourne-np
            - melbourne-qh2
            - melbourne-qh2-uom
            - monash-01
            - monash-02
            - monash-03
            - nci
            - qld
            - sa
            - swinburne-01
            - tasmania
            - tasmania-s
            - coreservices
            - qh2-test
            - cn
            - elk
          description: 'Availability zone.'
    properties:
      - authorization:
          'nobody':
            - job-read
            - job-discover

- job:
    name: tempest-ec2api-check
    defaults: global
    node: tempest
    concurrent: true
    scm:
      - git:
         url: ssh://review.rc.nectar.org.au:29418/internal/nectar-testing.git
         credentials-id: 4946c3a5-9f5e-4eac-9ec4-90e1e348db14
    builders:
      - shell: |
          #!/bin/bash
          . /opt/tempest/bin/activate
          tmpdir=`mktemp -d --suffix=_tempest`
          cd $WORKSPACE/tempest/
          ./setup_tempest.py -s $AVAILABILITY_ZONE -e $CLOUD -j check-ec2api $tmpdir
          ./setup_ec2api_image.py $tmpdir
          cd $tmpdir
          stestr run --serial --whitelist-file $WORKSPACE/tempest/whitelists/check-ec2api.yaml 2>&1 | grep --line-buffered -vE ' \w+Warning: |self._sock = None'
          RET=${PIPESTATUS[0]}
          rm -rf $tmpdir
          exit $RET
    parameters:
      - choice:
          name: 'CLOUD'
          choices:
            - production
            - testing
            - development
          description: "Cloud to run tempest on (production, testing or development). Leave as Production if unsure."
      - choice:
          name: 'AVAILABILITY_ZONE'
          choices:
            - auckland
            - intersect-01
            - melbourne-np
            - melbourne-qh2
            - melbourne-qh2-uom
            - monash-01
            - monash-02
            - monash-03
            - nci
            - qld
            - sa
            - swinburne-01
            - tasmania
            - tasmania-s
            - coreservices
            - qh2-test
            - cn
            - elk
          description: 'Availability zone.'
    properties:
      - authorization:
          'nobody':
            - job-read
            - job-discover


- job:
    name: tempest-neutron-check
    defaults: global
    node: tempest
    concurrent: true
    scm:
      - git:
         url: ssh://review.rc.nectar.org.au:29418/internal/nectar-testing.git
         credentials-id: 4946c3a5-9f5e-4eac-9ec4-90e1e348db14
    builders:
      - shell: |
          #!/bin/bash
          . /opt/tempest/bin/activate
          tmpdir=`mktemp -d --suffix=_tempest`
          cd $WORKSPACE/tempest/
          ./setup_tempest.py -e $CLOUD -j check-scenario $tmpdir
          cd $tmpdir
          stestr run --serial --whitelist-file $WORKSPACE/tempest/whitelists/check-neutron.yaml 2>&1 | grep --line-buffered -vE ' \w+Warning: |self._sock = None'
          RET=${PIPESTATUS[0]}
          rm -rf $tmpdir
          exit $RET
    parameters:
      - choice:
          name: 'CLOUD'
          choices:
            - production
            - testing
            - development
          description: "Cloud to run tempest on (production, testing or development). Leave as Production if unsure."
    properties:
      - authorization:
          'nobody':
            - job-read
            - job-discover

- job:
    name: tempest-scenario-check
    defaults: global
    node: tempest
    concurrent: true
    scm:
      - git:
         url: ssh://review.rc.nectar.org.au:29418/internal/nectar-testing.git
         credentials-id: 4946c3a5-9f5e-4eac-9ec4-90e1e348db14
    builders:
      - shell: |
          #!/bin/bash
          . /opt/tempest/bin/activate
          tmpdir=`mktemp -d --suffix=_tempest`
          cd $WORKSPACE/tempest/
          ./setup_tempest.py --host $HOST -s $AVAILABILITY_ZONE -e $CLOUD -j check-scenario $tmpdir
          cd $tmpdir
          stestr run --serial --whitelist-file $WORKSPACE/tempest/whitelists/check-scenario.yaml 2>&1 | grep --line-buffered -vE ' \w+Warning: |self._sock = None'
          RET=${PIPESTATUS[0]}
          rm -rf $tmpdir
          exit $RET
    parameters:
      - choice:
          name: 'CLOUD'
          choices:
            - production
            - testing
            - development
          description: "Cloud to run tempest on (Production, Test, Dev). Leave as Production if unsure."
      - choice:
          name: 'AVAILABILITY_ZONE'
          choices:
            - auckland
            - intersect-01
            - melbourne-np
            - melbourne-qh2
            - melbourne-qh2-uom
            - monash-01
            - monash-02
            - monash-03
            - nci
            - qld
            - sa
            - swinburne-01
            - tasmania
            - tasmania-s
            - coreservices
            - qh2-test
            - cn
            - elk
          description: 'Availability zone.'
      - string:
          name: 'HOST'
          description: |
                Nova host to test. <br>
                - Host must be in AVAILABILITY_ZONE; if not nova will return a 'No Valid Host' error.<br>
                - Leave blank to let scheduler choose a host.
    properties:
      - authorization:
          'nobody':
            - job-read
            - job-discover

- job:
    name: tempest-murano-check
    defaults: global
    node: tempest
    concurrent: true
    scm:
      - git:
         url: ssh://review.rc.nectar.org.au:29418/internal/nectar-testing.git
         credentials-id: 4946c3a5-9f5e-4eac-9ec4-90e1e348db14
    builders:
      - shell: |
          #!/bin/bash
          . /opt/tempest/bin/activate
          tmpdir=`mktemp -d --suffix=_tempest`
          cd $WORKSPACE/tempest/
          ./setup_tempest.py -s $AVAILABILITY_ZONE -e $CLOUD -j check-murano $tmpdir
          cd $tmpdir
          stestr run -n murano_tempest_tests.tests.scenario.application_catalog.test_deployment.TestMuranoDeployment.test_app_deployment 2>&1 | grep --line-buffered -vE ' \w+Warning: |self._sock = None'
          RET=${PIPESTATUS[0]}
          rm -rf $tmpdir
          exit $RET
    parameters:
      - choice:
          name: 'CLOUD'
          choices:
            - production
            - testing
            - development
          description: "Cloud to run tempest on (Production, Test, Dev). Leave as Production if unsure."
      - choice:
          name: 'AVAILABILITY_ZONE'
          choices:
            - auckland
            - intersect-01
            - melbourne-np
            - melbourne-qh2
            - melbourne-qh2-uom
            - monash-01
            - monash-02
            - monash-03
            - nci
            - qld
            - sa
            - swinburne-01
            - tasmania
            - tasmania-s
            - coreservices
            - qh2-test
            - cn
            - elk
          description: 'Availability zone.'
    properties:
      - authorization:
          'nobody':
            - job-read
            - job-discover


- job:
    name: tempest-trove-check
    defaults: global
    node: tempest
    concurrent: true
    scm:
      - git:
         url: ssh://review.rc.nectar.org.au:29418/internal/nectar-testing.git
         credentials-id: 4946c3a5-9f5e-4eac-9ec4-90e1e348db14
    builders:
      - shell: |
          #!/bin/bash
          . /opt/tempest/bin/activate
          tmpdir=`mktemp -d --suffix=_tempest`
          cd $WORKSPACE/tempest/
          ./setup_tempest.py -s $AVAILABILITY_ZONE -e $CLOUD -j check-trove $tmpdir
          cd $tmpdir
          stestr run -n trove_tempest_plugin.tests.scenario.database.test_basic_instance_ops.DatabaseScenarioTest.test_create_instances 2>&1 | grep --line-buffered -vE ' \w+Warning: |self._sock = None'
          RET=${PIPESTATUS[0]}
          rm -rf $tmpdir
          exit $RET
    parameters:
      - choice:
          name: 'CLOUD'
          choices:
            - production
            - testing
            - development
          description: "Cloud to run tempest on (Production, Test, Dev). Leave as Production if unsure."
      - choice:
          name: 'AVAILABILITY_ZONE'
          choices:
            - auckland
            - intersect-01
            - melbourne-np
            - melbourne-qh2
            - melbourne-qh2-uom
            - monash-01
            - monash-02
            - monash-03
            - nci
            - qld
            - sa
            - swinburne-01
            - tasmania
            - tasmania-s
            - coreservices
            - qh2-test
            - cn
            - elk
          description: 'Availability zone.'
    properties:
      - authorization:
          'nobody':
            - job-read
            - job-discover


- job:
    name: tempest-designate-check
    defaults: global
    node: tempest
    concurrent: true
    scm:
      - git:
         url: ssh://review.rc.nectar.org.au:29418/internal/nectar-testing.git
         credentials-id: 4946c3a5-9f5e-4eac-9ec4-90e1e348db14
    builders:
      - shell: |
          #!/bin/bash
          . /opt/tempest/bin/activate
          tmpdir=`mktemp -d --suffix=_tempest`
          cd $WORKSPACE/tempest/
          ./setup_tempest.py -e $CLOUD -j check-designate $tmpdir
          cd $tmpdir
          stestr run -n designate_tempest_plugin.tests.scenario.v2.test_recordsets.RecordsetsTest 2>&1 | grep --line-buffered -vE ' \w+Warning: |self._sock = None'
          RET=${PIPESTATUS[0]}
          rm -rf $tmpdir
          exit $RET
    parameters:
      - choice:
          name: 'CLOUD'
          choices:
            - production
            - testing
            - development
          description: "Cloud to run tempest on (Production, Test, Dev). Leave as Production if unsure."
    properties:
      - authorization:
          'nobody':
            - job-read
            - job-discover


- job:
    name: tempest-fwaas-check
    defaults: global
    node: tempest
    concurrent: true
    scm:
      - git:
         url: ssh://review.rc.nectar.org.au:29418/internal/nectar-testing.git
         credentials-id: 4946c3a5-9f5e-4eac-9ec4-90e1e348db14
    builders:
      - shell: |
          #!/bin/bash
          . /opt/tempest/bin/activate
          tmpdir=`mktemp -d --suffix=_tempest`
          cd $WORKSPACE/tempest/
          ./setup_tempest.py -s $AVAILABILITY_ZONE -e $CLOUD -j check-scenario $tmpdir
          cd $tmpdir
          stestr run neutron_fwaas.tests.tempest_plugin.tests.scenario.test_fwaas.TestFWaaS.test_firewall_insert_rule --serial  2>&1 | grep --line-buffered -vE ' \w+Warning: |self._sock = None'
          RET=${PIPESTATUS[0]}
          rm -rf $tmpdir
          exit $RET
    parameters:
      - choice:
          name: 'CLOUD'
          choices:
            - production
            - testing
            - development
          description: "Cloud to run tempest on (Production, Test, Dev). Leave as Production if unsure."
      - choice:
          name: 'AVAILABILITY_ZONE'
          choices:
            - auckland
            - intersect-01
            - melbourne-np
            - melbourne-qh2
            - melbourne-qh2-uom
            - monash-01
            - monash-02
            - monash-03
            - nci
            - qld
            - sa
            - swinburne-01
            - tasmania
            - tasmania-s
            - coreservices
            - qh2-test
            - cn
            - elk
          description: 'Availability zone.'
    properties:
      - authorization:
          'nobody':
            - job-read
            - job-discover


- job:
    name: tempest-lbaas-check
    defaults: global
    node: tempest
    concurrent: true
    scm:
      - git:
         url: ssh://review.rc.nectar.org.au:29418/internal/nectar-testing.git
         credentials-id: 4946c3a5-9f5e-4eac-9ec4-90e1e348db14
    builders:
      - shell: |
          #!/bin/bash
          . /opt/tempest/bin/activate
          tmpdir=`mktemp -d --suffix=_tempest`
          cd $WORKSPACE/tempest/
          ./setup_tempest.py -s $AVAILABILITY_ZONE -e $CLOUD -j check-scenario $tmpdir
          cd $tmpdir
          stestr run -n neutron_lbaas.tests.tempest.v2.scenario.test_load_balancer_basic.TestLoadBalancerBasic.test_load_balancer_basic 2>&1 | grep --line-buffered -vE ' \w+Warning: |self._sock = None'
          RET=${PIPESTATUS[0]}
          rm -rf $tmpdir
          exit $RET
    parameters:
      - choice:
          name: 'CLOUD'
          choices:
            - production
            - testing
            - development
          description: "Cloud to run tempest on (Production, Test, Dev). Leave as Production if unsure."
      - choice:
          name: 'AVAILABILITY_ZONE'
          choices:
            - auckland
            - intersect-01
            - melbourne-np
            - melbourne-qh2
            - melbourne-qh2-uom
            - monash-01
            - monash-02
            - monash-03
            - nci
            - qld
            - sa
            - swinburne-01
            - tasmania
            - tasmania-s
            - coreservices
            - qh2-test
            - cn
            - elk
          description: 'Availability zone.'
    properties:
      - authorization:
          'nobody':
            - job-read
            - job-discover
    triggers:
      - parameterized-timer:
          cron: "@midnight % CLOUD=testing; AVAILABILITY_ZONE=coreservices"


- job:
    name: tempest-sahara-check
    defaults: global
    node: tempest
    concurrent: true
    scm:
      - git:
         url: ssh://review.rc.nectar.org.au:29418/internal/nectar-testing.git
         credentials-id: 4946c3a5-9f5e-4eac-9ec4-90e1e348db14
    wrappers:
      - timeout:
          timeout: 45
          fail: true
    builders:
      - shell: |
          #!/bin/bash
          . /opt/tempest/bin/activate
          $WORKSPACE/nagios/tempest_nagios.py sahara -c $WORKSPACE/nagios/tempest_nagios.conf -s $AVAILABILITY_ZONE -e $CLOUD -p $PLUGIN -pv $PLUGIN_VERSION

    parameters:
      - choice:
          name: 'CLOUD'
          choices:
            - production
            - testing
            - development
          description: "Cloud to run tempest on (Production, Test, Dev). Leave as Production if unsure."
      - choice:
          name: 'PLUGIN'
          choices:
            - spark
            - vanilla
          description: "Sahara plugin (spark, vanilla etc.). Leave as Spark for now."
      - choice:
          name: 'PLUGIN_VERSION'
          choices:
            - 2.1.0
            - 1.6.0
            - 1.3.1
            - 2.7.1
          description: "Sahara plugin version (spark(2.1.0/1.6.0/1.3.1), vanilla(2.7.1) etc.). Leave as Spark version for now."
      - choice:
          name: 'AVAILABILITY_ZONE'
          choices:
            - auckland
            - intersect-01
            - melbourne-np
            - melbourne-qh2
            - melbourne-qh2-uom
            - monash-01
            - monash-02
            - monash-03
            - nci
            - qld
            - sa
            - swinburne-01
            - tasmania
            - tasmania-s
            - coreservices
            - qh2-test
            - cn
            - elk
          description: 'Availability zone.'
    properties:
      - authorization:
          'nobody':
            - job-read
            - job-discover


- job:
    name: tempest-community-image-check
    defaults: global
    node: tempest
    concurrent: true
    scm:
      - git:
         url: ssh://review.rc.nectar.org.au:29418/internal/nectar-testing.git
         credentials-id: 4946c3a5-9f5e-4eac-9ec4-90e1e348db14
    builders:
      - shell: |
          #!/bin/bash
          . /opt/tempest/bin/activate
          tmpdir=`mktemp -d --suffix=_tempest`
          cd $WORKSPACE/tempest/
          ./setup_tempest.py --image $IMAGE_ID -e production -j community-images $tmpdir
          cd $tmpdir
          stestr run --serial --whitelist-file $WORKSPACE/tempest/whitelists/community-images.yaml 2>&1 | grep --line-buffered -vE ' \w+Warning: |self._sock = None'
          RET=${PIPESTATUS[0]}
          rm -rf $tmpdir
          exit $RET
    parameters:
      - string:
          name: 'IMAGE_ID'
          description: |
                Id of the image to test. <br>
    properties:
      - authorization:
          'nobody':
            - job-read
            - job-discover

- project:
    name: tempest-nagios-site-compute
    site:
        - auckland
        - intersect-01
        - melbourne-np
        - melbourne-qh2
        - melbourne-qh2-uom
        - monash-01
        - monash-02
        - monash-03
        - nci
        - qld
        - sa
        - swinburne-01
        - tasmania
        - tasmania-s
    jobs:
      - 'tempest-nagios-site-{site}-{test}':
          test:
            - 'compute'
      - 'tempest-cleanup-site-{site}'

- project:
    name: tempest-nagios-site-network
    site:
        - auckland
        - melbourne-np
        - melbourne-qh2
        - monash-02
        - qld
        - tasmania
    jobs:
      - 'tempest-nagios-site-{site}-{test}':
          test:
            - 'network'

- project:
    name: tempest-nagios-flavor
    flavor:
        - tiny
        - xsmall
        - small
        - medium
        - large
        - xlarge
    jobs:
      - 'tempest-nagios-flavor-{flavor}-{test}':
          test:
            - 'compute'


- job-template:
    name: 'tempest-nagios-site-{site}-{test}'
    defaults: global
    node: tempest
    concurrent: false

    scm:
      - git:
         url: ssh://review.rc.nectar.org.au:29418/internal/nectar-testing.git
         credentials-id: 4946c3a5-9f5e-4eac-9ec4-90e1e348db14

    wrappers:
      - timeout:
          timeout: 20
          fail: true

    builders:
      - shell: |
          . /opt/tempest/bin/activate
          $WORKSPACE/nagios/tempest_nagios.py tempest -c $WORKSPACE/nagios/tempest_nagios.conf -s {site} -t {test} -e production

    triggers:
      - timed: 'H/30 * * * *'

    publishers:
      - naginator:
          max-failed-builds: 4
          fixed-delay: 120
      - trigger:
          project: 'tempest-cleanup-site-{site}'
          threshold: 'FAILURE'

    properties:
      - authorization:
          'anonymous':
            - job-read
            - job-discover
      - build-discarder:
          days-to-keep: 7


- job-template:
    name: 'tempest-nagios-flavor-{flavor}-{test}'
    defaults: global
    node: tempest
    concurrent: false

    scm:
      - git:
         url: ssh://review.rc.nectar.org.au:29418/internal/nectar-testing.git
         credentials-id: 4946c3a5-9f5e-4eac-9ec4-90e1e348db14

    wrappers:
      - timeout:
          timeout: 45
          fail: true

    builders:
      - shell: |
          . /opt/tempest/bin/activate
          $WORKSPACE/nagios/tempest_nagios.py tempest -c $WORKSPACE/nagios/tempest_nagios.conf -f {flavor} -t {test} -e production

    triggers:
      - timed: 'H * * * *'

    publishers:
      - naginator:
          max-failed-builds: 4
          fixed-delay: 120
      - trigger:
          project: 'tempest-cleanup'
          threshold: 'FAILURE'

    properties:
      - authorization:
          'anonymous':
            - job-read
            - job-discover
      - build-discarder:
          days-to-keep: 7

- job-template:
    name: 'tempest-cleanup-site-{site}'
    defaults: global
    node: tempest
    concurrent: false

    scm:
      - git:
         url: ssh://review.rc.nectar.org.au:29418/internal/nectar-testing.git
         credentials-id: 4946c3a5-9f5e-4eac-9ec4-90e1e348db14

    wrappers:
      - timeout:
          timeout: 5
          fail: true

    builders:
      - shell: |
          . /opt/tempest/bin/activate
          $WORKSPACE/nagios/tempest_purge.py -e production -s {site} --no-dry-run

    properties:
      - authorization:
          'anonymous':
            - job-read
            - job-discover
      - build-blocker:
          blocking-jobs:
            - "^tempest-nagios-site-{site}-.*"
          block-level: 'GLOBAL'
          queue-scanning: 'ALL'
      - build-discarder:
          days-to-keep: 7


- job:
    name: 'tempest-cleanup'
    defaults: global
    node: tempest
    concurrent: false

    scm:
      - git:
         url: ssh://review.rc.nectar.org.au:29418/internal/nectar-testing.git
         credentials-id: 4946c3a5-9f5e-4eac-9ec4-90e1e348db14

    wrappers:
      - timeout:
          timeout: 5
          fail: true

    builders:
      - shell: |
          . /opt/tempest/bin/activate
          $WORKSPACE/nagios/tempest_purge.py -e production --no-dry-run

    properties:
      - authorization:
          'anonymous':
            - job-read
            - job-discover
      - build-blocker:
          blocking-jobs:
            - "^tempest-nagios-flavor-.*"
          block-level: 'GLOBAL'
          queue-scanning: 'ALL'


- job:
    name: 'tempest-cleanup-operator'
    defaults: global
    node: tempest
    concurrent: false

    scm:
      - git:
         url: ssh://review.rc.nectar.org.au:29418/internal/nectar-testing.git
         credentials-id: 4946c3a5-9f5e-4eac-9ec4-90e1e348db14

    wrappers:
      - timeout:
          timeout: 5
          fail: true

    builders:
      - shell: |
          . /opt/tempest/bin/activate
          $WORKSPACE/nagios/tempest_purge.py -e production -j operator --no-dry-run

    triggers:
      - timed: '30 2 * * *'

    properties:
      - authorization:
          'anonymous':
            - job-read
            - job-discover
      - build-blocker:
          blocking-jobs:
            - "^.*tempest-compute-host-check"
          block-level: 'GLOBAL'
          queue-scanning: 'ALL'
